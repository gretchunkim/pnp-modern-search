name: Release Modern Search Extensibility package

on:
    workflow_dispatch:

jobs:
    extensibility-release:
        # The type of runner that the job will run on
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: ./search-extensibility

        # Steps represent a sequence of tasks that will be executed as part of the job
        steps:
            # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
            - uses: actions/checkout@v4
              with:
                  ref: develop
            # setup nodejs
            - name: Use Node.js 22
              uses: actions/setup-node@v4
              with:
                  node-version: 22
                  registry-url: "https://registry.npmjs.org"
            # Setup pnpm for consistent dependency management
            - name: Setup pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: 9

            # cache node modules
            - name: Cache node modules
              id: cache
              uses: actions/cache@v4
              with:
                  path: |
                      **/node_modules
                  key: node_modules-${{ hashFiles('**/pnpm-lock.yaml', '**/package-lock.json') }}

            # if cache failed, use pnpm to install
            - name: Restore dependencies
              if: steps.cache.outputs.cache-hit != 'true'
              run: pnpm install

            # Runs a set of commands using the runners shell
            - name: Test - not setup
              run: echo this would be the tests

            # Build using heft (SPFx 1.22+)
            - name: Build
              run: pnpm run build

            - name: Publish
              run: npm publish
              env:
                  NODE_AUTH_TOKEN: ${{ secrets.NPM_PUBLISH_TOKEN }}
